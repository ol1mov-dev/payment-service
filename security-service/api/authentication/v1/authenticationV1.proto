syntax = "proto3";

package authentication.v1;

option go_package = "user-service/pkg/api/security/v1";

import "google/protobuf/timestamp.proto";

// ========== SERVICE ==========
service AuthenticationV1Service {
  // Вход по email/паролю или OAuth-токену
  rpc Login(LoginRequest) returns (LoginResponse);

  // Обновление токенов
  rpc RefreshToken(RefreshRequest) returns (RefreshResponse);

  // Выход (инвалидация refresh токена)
  rpc Logout(LogoutRequest) returns (LogoutResponse);

  // Проверка валидности access токена
  rpc ValidateToken(ValidateTokenRequest) returns (ValidateTokenResponse);
}

// --- Логин ---
message LoginRequest {
  oneof credential {
    PasswordCredentials pwd = 1;
    OAuthCredentials oauth = 2;
  }
}

message PasswordCredentials {
  string email = 1;
  string password = 2;
}

message OAuthCredentials {
  string provider = 1;
  string oauth_token = 2;
}

message LoginResponse {
  string user_id = 1;
  TokenPair tokens = 2;
}

// --- Токены ---
message TokenPair {
  string access_token = 1;
  string refresh_token = 2;
  int64 access_expires_in = 3;
  int64 refresh_expires_in = 4;
  google.protobuf.Timestamp issued_at = 5;
}

// --- Обновление токена ---
message RefreshRequest {
  string refresh_token = 1;
}

message RefreshResponse {
  TokenPair tokens = 1;
}

// --- Logout ---
message LogoutRequest {
  string refresh_token = 1;
}

message LogoutResponse {
  bool success = 1;
  string message = 2;
}

// --- Валидация токена ---
message ValidateTokenRequest {
  string access_token = 1;
}

message ValidateTokenResponse {
  bool valid = 1;
  string user_id = 2;
  repeated string roles = 3;
  repeated string permissions = 4;
  google.protobuf.Timestamp expires_at = 5;
  string error = 6;
}